<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:t="http://java.sun.com/jsf/composite/telveComponents"
                xmlns:p="http://primefaces.org/ui"                   
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                template="/layout/primeTemplate.xhtml">


    <ui:define name="body">

        <script>
            jQuery(document).ready(function () {
                jQuery('#paramNewButton').click(function () {
                    if (this.isEnabled()) {
                        newParameter();
                    }
                });
            });
        </script>

        <ui:include src="/layout/messages.xhtml" />
        <p:layout >
            <p:layoutUnit position="west" size="300" header="#{messages['general.caption.List']}" collapsible="true" resizable="true">
                <h:form id="listForm">
                    <p:remoteCommand name="newParameter" update=":form" action="#{userHome.createNew()}"  partialSubmit="true" process="@this" />
                    <p:dataTable id="itemlist" 
                                 var="item"
                                 value="#{userHome.entityList}" 
                                 rowKey="rowKey"
                                 emptyMessage="#{messages['general.hint.EmptyList']}"
                                 rows="15"
                                 filteredValue="#{userHome.filteredList}"
                                 paginatorAlwaysVisible="false"
                                 paginator="true"
                                 paginatorPosition="bottom"
                                 paginatorTemplate="{PageLinks}">
                        <p:column filterBy="#{item.loginName}" 
                                  filterMatchMode="contains">
                            <p:commandLink action="#{userHome.edit(item)}" ajax="true" partialSubmit="true" process="@this" update=":form">
                                <h:outputText value="#{item.loginName}" />
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                </h:form>
            </p:layoutUnit>
            <p:layoutUnit position="center"  >



                <p:panel header="#{messages['module.caption.User']}">
                    <h:form id="form" >
                        <ui:fragment rendered="#{userHome.getUserTypes().size() gt 1}">
                            <div class="row">
                                <t:inputCombobox label="user.label.UserType" value="#{userHome.userType}" required="true" last="true">
                                    <f:selectItems value="#{userHome.getUserTypes()}" var="ut" itemLabel="#{messages[ 'userType.label.'.concat(ut) ]}" itemValue="#{ut}" />
                                    <ui:remove>
                                        <p:ajax event="onchange" update=":form:extentions" />
                                    </ui:remove>
                                </t:inputCombobox>
                            </div>
                        </ui:fragment>
                        <div class="row">
                            <t:inputText label="user.label.UserName" value="#{userHome.current.loginName}" required="true" />
                            <t:inputText label="user.label.FirstName" value="#{userHome.current.firstName}" required="true" />
                            <t:inputText label="user.label.Email" value="#{userHome.current.email}" required="true" />
                            <t:inputText label="user.label.LastName" value="#{userHome.current.lastName}" required="true" />
                        </div>  

                        <div id="extentions">
                            <c:forEach items="#{userHome.UIFragments}" var="fragment" varStatus="loop">
                                <ui:include src="#{fragment}" />
                            </c:forEach>
                        </div>


                        <t:accordion label="#{messages['user.caption.Roles']}" hide="false">
                            <div class="row">
                                <t:inputAny label="general.label.Roles" columnClass="large-6 middle-12 small-12">
                                    <p:pickList id="rolepicker" 
                                                value="#{userHome.roleList}" 
                                                var="role" 
                                                itemLabel="#{role.name}" 
                                                itemValue="#{role}"
                                                showSourceFilter="true" 
                                                showTargetFilter="true" 
                                                showCheckbox="true"
                                                filterMatchMode="contains"
                                                converter="roleConverter">
                                        <f:facet name="sourceCaption">Available</f:facet>
                                        <f:facet name="targetCaption">Selected</f:facet>
                                    </p:pickList>
                                </t:inputAny>
                            </div>
                        </t:accordion>

                        <div class="actionButtons">
                            <p:commandButton id="saveAndNew" 
                                             value="#{messages['general.button.SaveAndNew']}" 
                                             action="#{userHome.saveAndNew()}"
                                             rendered="#{identity.hasPermission( 'user', 'update') }"
                                             ajax="true"
                                             partialSubmit="false"
                                             process="@form"
                                             update=":form,:listForm:itemlist"
                                             validateClient="true"
                                             icon="ui-icon-disk"/>  

                            <p:commandButton id="save" 
                                             value="#{messages['general.button.Save']}" 
                                             action="#{userHome.save()}"
                                             rendered="#{identity.hasPermission( 'user', 'insert')}"
                                             ajax="true"
                                             partialSubmit="false"
                                             process="@form"
                                             update=":form,:listForm:itemlist"
                                             validateClient="true"
                                             icon="ui-icon-disk" />  



                            <p:commandButton id="delete" 
                                             value="#{messages['general.button.Delete']}" 
                                             action="#{userHome.delete()}"
                                             rendered="#{identity.hasPermission( 'user', 'delete') }"
                                             ajax="true"
                                             partialSubmit="false"
                                             process="@form"
                                             update=":form,:listForm:itemlist"
                                             validateClient="true"
                                             icon="ui-icon-trash">
                                <p:confirm header="#{messages['general.caption.Confirm']}" message="#{messages['general.message.confirm.Delete']}" icon="ui-icon-alert" />
                            </p:commandButton>
                            <p:commandButton id="close" 
                                             value="#{messages['general.button.Close']}" 
                                             action="#{userHome.close()}"
                                             ajax="true"
                                             partialSubmit="true"
                                             process="@this"
                                             icon="ui-icon-close"/>
                        </div>
                    </h:form>
                </p:panel>
            </p:layoutUnit>
        </p:layout>

    </ui:define>
</ui:composition>