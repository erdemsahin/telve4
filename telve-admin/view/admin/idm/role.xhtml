<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:t="http://java.sun.com/jsf/composite/telveComponents"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui"                   
                template="/layout/primeTemplate.xhtml">

    <ui:param name="showListBar" value="true" />

    <ui:define name="body">
        <ui:include src="/layout/messages.xhtml" />

        <h:form id="form" >
            <div class="row">
                <t:inputText label="global.label.Name" value="#{roleHome.current.name}" required="true" />
            </div>  

            <script type="text/javascript">
                function toggleChkBoxes( group, act){
                    jQuery('[id$="'+act+'"]').find('[id*="'+ group+ '"]').trigger('click');
                }
                
                function toggleRowChkBoxes( group, elm ){
                    row = jQuery(elm).parent().parent().attr('data-ri');
                    jQuery('[id*="'+group+'\\:'+row+'\\:"]').trigger('click');
                }
            </script>
            
            <c:forEach id="groups" items="#{roleHome.permissions}"
                       var="pg" varStatus="pgs">
                <t:accordion id="#{pg.name}a" label="#{messages[ 'permission.label.'.concat( pg.name )]}" >

                    <p:dataTable id="#{pg.name}" value="#{pg.permissions}" var="pd" >
                        <p:column headerText="#{messages['role.label.Domain']}">
                            <a href="#" onclick="toggleRowChkBoxes('#{pg.name}', this )" title="#{messages[ 'permission.hint.'.concat( pd.definition.target)]}">
                                #{messages[ 'permission.label.'.concat( pd.definition.target)]}
                            </a>
                        </p:column>
                        <p:column style="width: 36px;">
                            <f:facet name="header">
                                <i class="fa fa-eye" title="#{messages['role.label.Select']}" onclick="toggleChkBoxes( '#{pg.name}', 'select')"></i>
                            </f:facet>
                            <p:selectBooleanCheckbox id="select" value="#{pd.select}" rendered="#{pd.definition.hasSelectAction()}"/>  
                        </p:column>
                        <p:column style="width: 36px;">
                            <f:facet name="header">
                                <i class="fa fa-plus" title="#{messages['role.label.Insert']}" onclick="toggleChkBoxes( '#{pg.name}', 'insert')"></i>
                            </f:facet>
                            <p:selectBooleanCheckbox id="insert" value="#{pd.insert}" rendered="#{pd.definition.hasInsertAction()}"/> 
                        </p:column>
                        <p:column  style="width: 36px;">
                            <f:facet name="header">
                                <i class="fa fa-edit" title="#{messages['role.label.Update']}" onclick="toggleChkBoxes( '#{pg.name}', 'update')"></i>
                            </f:facet>
                            <p:selectBooleanCheckbox id="update" value="#{pd.update}" rendered="#{pd.definition.hasUpdateAction()}"/> 
                        </p:column>
                        <p:column style="width: 36px;">
                            <f:facet name="header">
                                <i class="fa fa-trash" title="#{messages['role.label.Delete']}" onclick="toggleChkBoxes( '#{pg.name}', 'delete')"></i>
                            </f:facet>
                            <p:selectBooleanCheckbox id="delete" value="#{pd.delete}" rendered="#{pd.definition.hasDeleteAction()}"/> 
                        </p:column>
                        <p:column style="width: 36px;">
                            <f:facet name="header">
                                <i class="fa fa-share-square-o" title="#{messages['role.label.Export']}" onclick="toggleChkBoxes( '#{pg.name}', 'export')"></i>
                            </f:facet>
                            <p:selectBooleanCheckbox id="export" value="#{pd.export}" rendered="#{pd.definition.hasExportAction()}"/> 
                        </p:column>
                        <p:column style="width: 36px;">
                            <f:facet name="header">
                                <i class="fa fa-gear" title="#{messages['role.label.Exec']}" onclick="toggleChkBoxes( '#{pg.name}', 'exec')"> </i>
                            </f:facet>
                            <p:selectBooleanCheckbox id="exec" value="#{pd.exec}" rendered="#{pd.definition.hasSelectAction()}"/> 
                        </p:column>
                    </p:dataTable>
                </t:accordion>
            </c:forEach>

            <div class="actionButtons">
                <p:commandButton id="saveAndNew" 
                                 value="#{messages['general.button.SaveAndNew']}" 
                                 action="#{roleHome.saveAndNew()}"
                                 rendered="#{identity.hasPermission( 'role', 'update') }"
                                 ajax="true"
                                 partialSubmit="false"
                                 process="@form"
                                 update=":form,:listForm:itemlist"
                                 validateClient="true"
                                 icon="ui-icon-disk"/>  

                <p:commandButton id="save" 
                                 value="#{messages['general.button.Save']}" 
                                 action="#{roleHome.save()}"
                                 rendered="#{identity.hasPermission( 'role', 'insert')}"
                                 ajax="true"
                                 partialSubmit="false"
                                 process="@form"
                                 update=":form,:listForm:itemlist"
                                 validateClient="true"
                                 icon="ui-icon-disk" />  



                <p:commandButton id="delete" 
                                 value="#{messages['general.button.Delete']}" 
                                 action="#{roleHome.delete()}"
                                 rendered="#{identity.hasPermission( 'role', 'delete') }"
                                 ajax="true"
                                 partialSubmit="false"
                                 process="@form"
                                 update=":form,:listForm:itemlist"
                                 validateClient="true"
                                 icon="ui-icon-trash">
                    <p:confirm header="#{messages['general.caption.Confirm']}" message="#{messages['general.message.confirm.Delete']}" icon="ui-icon-alert" />
                </p:commandButton>
                <p:commandButton id="close" 
                                 value="#{messages['general.button.Close']}" 
                                 action="#{roleHome.close()}"
                                 ajax="true"
                                 partialSubmit="true"
                                 process="@this"
                                 icon="ui-icon-close"/>
            </div>
        </h:form>


    </ui:define>

    <ui:define name="content-list">
        <h:form id="listForm">
            <p:dataTable id="itemlist" 
                         var="item"
                         value="#{roleHome.entityList}" 
                         rowKey="rowKey"
                         emptyMessage="#{messages['general.hint.EmptyList']}"
                         rows="15"
                         filteredValue="#{roleHome.filteredList}"
                         paginatorAlwaysVisible="false"
                         paginator="true"
                         paginatorPosition="bottom"
                         paginatorTemplate="{PageLinks}">
                <p:column filterBy="#{item.name}" 
                          filterMatchMode="contains">
                    <p:commandLink action="#{roleHome.edit(item)}" ajax="true" partialSubmit="true" process="@this" update=":form">
                        <h:outputText value="#{item.name}" />
                    </p:commandLink>
                </p:column>
            </p:dataTable>
        </h:form>
    </ui:define>
    
    <ui:define name="context-menu">
        <li>
            <p:commandLink name="newParameter" update=":form" action="#{roleHome.createNew()}"  partialSubmit="true" process="@this">
                <i class="fa fa-plus-circle"></i>
                #{messages['general.button.New']}
            </p:commandLink>
        </li>
    </ui:define>
</ui:composition>