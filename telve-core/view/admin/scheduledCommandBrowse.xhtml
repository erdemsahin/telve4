<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:t="http://java.sun.com/jsf/composite/telveComponents"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui"                   
                template="/layout/primeTemplate.xhtml">


    <ui:define name="body">
        <ui:include src="/layout/messages.xhtml" />

        <h:form id="filterSearch">
            <div class="row">
                <div class="col-md-8 col-xs-12"></div>
                <div class="prop col-md-4 col-xs-12">
                    <span class="value">
                        <div class="input-group">
                            <p:inputText id="filter" value="#{scheduledCommandBrowse.filter}" 
                                         placeholder="#{messages['general.info.ScheduledCommandBrowseFilter']}" />
                            <div class="input-group-btn">
                            <p:commandButton action="#{scheduledCommandBrowse.search()}" partialSubmit="true" process="@form" icon="fa fa-search" styleClass="ui-icon-only btn btn-default" update=":commands" />
                            </div>
                        </div>
                    </span>
                </div>
            </div>
        </h:form>

        <div class="box box-primary">
            <div class="box-body">
        <h:form id="commands">
            <p:dataTable value="#{scheduledCommandBrowse.filteredItems}" var="item"
                         selectionMode="single"
                         selection="#{scheduledCommandBrowse.selectedItem}" 
                         rowKey="#{item.id}" >


                <p:ajax event="rowSelect" listener="#{scheduledCommandBrowse.onRowSelect}" />


                <p:column headerText="#{messages['general.label.Type']}">
                    #{messages['command.name.'.concat( item.command.class.simpleName) ]}
                </p:column>
                <p:column headerText="#{messages['general.label.Name']}">
                    #{item.name}
                </p:column>
                <p:column headerText="#{messages['general.label.Info']}">
                    #{item.info}
                </p:column>
                <ui:remove>
                    <p:column headerText="#{messages['general.label.Params']}">
                        #{item.params}
                    </p:column>
                </ui:remove>
                <p:column headerText="#{messages['general.label.NextTimeout']}">
                    <t:cellOutputDateTime value="#{item.nextTimeout}" /> - #{item.timeRemainingStr}
                </p:column>
                <p:column headerText="#{messages['general.label.Schedule']}">
                    #{item.scheduleStr}
                </p:column>
            </p:dataTable>
        </h:form>
            </div>
        </div>



        <p:dialog id="commandSelectorPopup"  header="#{messages['module.caption.CommandSelectorPopup']}" widgetVar="commandSelectorPopup" modal="true" width="420">
            <div class="row">
                <ui:repeat value="#{scheduledCommandBrowse.editorNames}" var="item" varStatus="loop2">
                    <div class="col-xs-2">
                        <p:commandLink action="#{scheduledCommandBrowse.createNew(item)}" 
                                       ajax="true" partialSubmit="true" process="@this"
                                       update=":editorPopup"
                                       oncomplete="PF('commandSelectorPopup').hide();PF('editorPopup').show();">
                            <h:graphicImage value="#{scheduledCommandBrowse.getIconPath(item)}" />
                        </p:commandLink>
                    </div>
                    <div class="col-xs-10">
                        <div class="row">
                            <div class="col-xs-12">
                                <p:commandLink value="#{messages['command.name.'.concat( item )]}" 
                                               action="#{scheduledCommandBrowse.createNew(item)}" 
                                               ajax="true" partialSubmit="true" process="@this" 
                                               update=":editorPopup"
                                               oncomplete="PF('commandSelectorPopup').hide();PF('editorPopup').show();">
                                </p:commandLink>
                            </div>
                            <div class="col-xs-12">
                                #{messages['command.desc.'.concat( item )]} 
                            </div>
                        </div>
                    </div>
                </ui:repeat>
            </div>

            <div class="actionButtons">
                <p:button id="close" value="#{messages['general.button.Cancel']}" icon="ui-icon-close" onclick="PF('commandSelectorPopup').hide();"/>
            </div>

        </p:dialog>


        <p:dialog id="editorPopup"  header="#{messages['module.caption.CommandEditor']}" widgetVar="editorPopup" modal="true" width="500">
            <ui:fragment rendered="#{scheduledCommandBrowse.currentEditor ne null}">
                <h:form id="ceForm">

                    <div class="row">
                        <div class="col-xs-12" >
                            <strong>#{messages['command.name.'.concat( scheduledCommandBrowse.currentEditor.command.class.simpleName )]}</strong>
                        </div> 
                        <div class="col-xs-12" >
                            #{messages['command.desc.'.concat( scheduledCommandBrowse.currentEditor.command.class.simpleName )]} 
                        </div>
                    </div>

                    <div class="row">
                        <t:inputText label="general.label.Name" value="#{scheduledCommandBrowse.currentEditor.entity.name}"  required="true" columnClass="col-xs-12" />
                        <t:inputTextarea label="general.label.Info" value="#{scheduledCommandBrowse.currentEditor.entity.info}"  columnClass="col-xs-12" />
                    </div>

                    <ui:include src="#{scheduledCommandBrowse.currentEditor.dialogPageViewId}" />

                    <div class="actionButtons">
                        <p:commandButton id="save" value="#{messages['general.button.Ok']}" icon="ui-icon-check" action="#{scheduledCommandBrowse.currentEditor.save()}" update=":commands" oncomplete="PF('editorPopup').hide();"/>
                        <p:button id="close" value="#{messages['general.button.Cancel']}" icon="ui-icon-close" onclick="PF('editorPopup').hide();"/>
                    </div>
                </h:form>
            </ui:fragment>
        </p:dialog>

        <p:dialog id="schedulePopup"  header="#{messages['module.caption.Sheduler']}" widgetVar="schedulePopup" modal="true" width="500">
            <h:form id="schedulrForm">

                <div class="row">
                    <div class="col-xs-12" >
                        <strong>#{messages['command.name.'.concat( scheduledCommandBrowse.selectedItem.command.class.simpleName )]}</strong>
                    </div> 
                    <div class="col-xs-12" >
                        <strong>#{scheduledCommandBrowse.selectedItem.name}</strong>
                    </div> 
                    <div class="col-xs-12" >
                        #{scheduledCommandBrowse.selectedItem.info} 
                    </div>
                </div>

                <div class="row">
                    <t:inputCombobox label="Tip" value="#{scheduledCommandBrowse.scheduleType}">
                        <f:selectItem itemLabel="Bir Kere" itemValue="O" />
                        <f:selectItem itemLabel="Period" itemValue="P" />
                        <f:selectItem itemLabel="Düzenli" itemValue="S" />
                        <f:selectItem itemLabel="Gelişmiş" itemValue="SE" />
                        <p:ajax event="change" />
                    </t:inputCombobox>
                </div>
                <div class="row">
                    <p:outputPanel autoUpdate="true">
                        <t:inputDateTime label="general.label.BeginDate" value="#{scheduledCommandBrowse.startDate}" />
                        <t:inputDateTime label="general.label.EndDate" value="#{scheduledCommandBrowse.endDate}" rendered="#{scheduledCommandBrowse.scheduleType ne 'O'}"/>
                        <t:inputCombobox label="Period" value="#{scheduledCommandBrowse.schedule}" rendered="#{scheduledCommandBrowse.scheduleType eq 'S'}" columnClass="col-xs-12">
                            <f:selectItem itemLabel="Saatlik" itemValue="Hourly" />
                            <f:selectItem itemLabel="Günlük" itemValue="Daily" />
                            <f:selectItem itemLabel="Haftalık" itemValue="Weekly" />
                            <f:selectItem itemLabel="Aylık" itemValue="Monthly" />
                        </t:inputCombobox>
                        <t:inputText label="genaral.label.Schedule" value="#{scheduledCommandBrowse.schedule}" rendered="#{scheduledCommandBrowse.scheduleType eq 'SE' or scheduledCommandBrowse.scheduleType eq 'P'}" columnClass="col-xs-12"/>
                    </p:outputPanel>
                </div>

                <ui:remove>
                    <t:inputSheduleExpression label="Schedule" value="" />
                </ui:remove>

                <div class="actionButtons row">
                    <p:commandButton id="save" value="#{messages['general.button.Ok']}" icon="ui-icon-check" action="#{scheduledCommandBrowse.schedule()}" update=":commands" oncomplete="PF('schedulePopup').hide();"/>
                    <p:button id="close" value="#{messages['general.button.Cancel']}" icon="ui-icon-close" onclick="PF('schedulePopup').hide();"/>
                </div>

            </h:form>
        </p:dialog>


    </ui:define>

    <ui:define name="context-menu">
        <ui:remove>
        <li>
            <p:commandLink id="newSuggestion" onclick="PF('commandSelectorPopup').show();" >
                <i class="fa fa-plus-circle"/>
                <span>#{messages['general.button.New']}</span>
            </p:commandLink>
        </li>
            </ui:remove>

        
        <li class="dropdown">
            <a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                <i class="fa fa-plus-circle"/>
                <span>#{messages['general.button.New']}</span>
                <i class="fa fa-caret-down" />
            </a>
            <ul class="dropdown-menu">
                <ui:repeat value="#{scheduledCommandBrowse.editorNames}" var="item" varStatus="loop2">
                    <li>
                        <p:commandLink value="#{messages['command.editor.'.concat( item )]}" 
                                               action="#{scheduledCommandBrowse.createNew(item)}" 
                                               ajax="true" partialSubmit="true" process="@this" 
                                               update=":editorPopup"
                                               oncomplete="PF('editorPopup').show();">
                        </p:commandLink>
                    </li>
                </ui:repeat>
            </ul>
        </li>
        
        <li>
            <p:commandLink  action="#{scheduledCommandBrowse.edit()}" update=":editorPopup"
                                               oncomplete="PF('editorPopup').show();" ajax="true" partialSubmit="true" process="@this" >
                <i class="fa fa-pencil"/>
                <span>#{messages['general.button.Edit']}</span>
            </p:commandLink>
        </li>

        <li>
            <p:commandLink  action="#{scheduledCommandBrowse.delete()}" update=":commands" ajax="true" partialSubmit="true" process="@this" >
                <i class="fa fa-trash"/>
                <span>#{messages['general.button.Delete']}</span>
            </p:commandLink>
        </li>

        <li>
            <p:commandLink  action="#{scheduledCommandBrowse.startSchedule()}" update=":schedulePopup" oncomplete="PF('schedulePopup').show();" ajax="true" partialSubmit="true" process="@this" >
                <i class="fa fa-calendar"/>
                <span>#{messages['general.button.StartShedule']}</span>
            </p:commandLink>
        </li>

        <li>
            <p:commandLink  action="#{scheduledCommandBrowse.stopSchedule()}" update=":commands" ajax="true" partialSubmit="true" process="@this" >
                <i class="fa fa-calendar-o"/>
                <span>#{messages['general.button.StopShedule']}</span>
            </p:commandLink>
        </li>

        <li>
            <p:commandLink  action="#{scheduledCommandBrowse.run()}" ajax="true" partialSubmit="true" process="@this" >
                <i class="fa fa-cogs"/>
                <span>#{messages['general.button.Run']}</span>
            </p:commandLink>
        </li>

    </ui:define>

</ui:composition>