<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:t="http://java.sun.com/jsf/composite/telveComponents"
                xmlns:r="http://richfaces.org/rich"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui">


    <div id="ribbon" class="wrap">
        <ui:remove>TODO: Bu satırı temizlemek lazım</ui:remove>
        <span class="ribbon-window-title">#{telveConfigResolver.getProperty('app.title')} - #{ messages[pageTitleResolver.pageTitle] }  #{ viewIdentifier ne null ? '[ '.concat( viewIdentifier ).concat(' ]') : '' } </span>

        <div class="ribbon-tab color-blue" id="currentView">
            <span class="ribbon-title">#{messages['menu.main.Context']}</span>

            <h:form>

                <div class="ribbon-section right">
                    <a href="#{helpResolver.helpPath}" target="HelpWinId" onclick="openHelp();" class="ribbon-button ribbon-button-small">
                        <span class="button-title">#{messages['module.caption.Help']}</span> 
                        <h:graphicImage url="/img/ribbon/small/help.png" styleClass="ribbon-icon ribbon-normal"/>
                    </a>

                    <h:link outcome="/branding/about.xhtml" styleClass="ribbon-button ribbon-button-small">
                        <span class="button-title">#{messages['general.button.About']}</span> 
                        <h:graphicImage url="/img/ribbon/small/help.png" styleClass="ribbon-icon ribbon-normal"/>
                    </h:link>


                    <h:commandLink action="#{identity.logout()}" styleClass="ribbon-button ribbon-button-small">
                        <span class="button-title">#{messages['general.button.Logout']}</span> 
                        <h:graphicImage url="/img/stop.png" styleClass="ribbon-icon ribbon-normal"/>
                    </h:commandLink>



                    <ui:remove>
                        <!-- push test -->
                        <p:commandLink action="#{emailChannel.sendMessage('hakan.uygun@ozguryazilim.com.tr', 'Deneme', 'Deneme Notify Mesajı')}" styleClass="ribbon-button ribbon-button-small"
                                       ajax="true" partialSubmit="true" process="@this">
                            <span class="button-title">#{messages['general.button.Push']}</span> 
                            <h:graphicImage url="/img/stop.png" styleClass="ribbon-icon ribbon-normal"/>
                        </p:commandLink>

                    </ui:remove>

                </div>

                <div class="ribbon-section right">

                    <p:commandLink action="#{noteController.openNotesDialog(''.concat(request.getHeader('Referer')))}" styleClass="ribbon-button ribbon-button-large"
                                   ajax="true" partialSubmit="true" process="@this" includeViewParams="true" rendered="#{noteController.canAddNote()}">
                        <span class="button-title">#{messages['general.button.Notes']}</span> 
                        <h:graphicImage url="/img/ribbon/large/note.png" styleClass="ribbon-icon ribbon-normal" />
                        <h:graphicImage value="/img/ribbon/bullet_valid.png" styleClass="ribbon-icon ribbon-overlay" rendered="#{noteController.hasNotes('')}"/>
                    </p:commandLink>

                    <p:commandLink action="#{noteController.openNewNoteDialog(request.getHeader('Referer'))}" styleClass="ribbon-button ribbon-button-small"
                                   ajax="true" partialSubmit="true" process="@this" includeViewParams="true" rendered="#{noteController.canAddNote()}">
                        <span class="button-title">#{messages['general.button.AddNote']}</span> 
                        <h:graphicImage url="/img/ribbon/small/note_add.png" styleClass="ribbon-icon ribbon-normal"/>
                    </p:commandLink>

                    <ui:remove>
                        <!-- 
                        request.requestURI.concat( '?' ).concat(request.queryString) çalışması lazım ama ajax üzerinde redirect yaparken parametreleri kaybediyor
                        o yüzden referer'ı kullanıyoruz.
                        -->
                    </ui:remove>
                    <p:commandLink action="#{bookmarkDashlet.addBookmark( messages[pageTitleResolver.pageTitle], viewIdentifier, request.getHeader('Referer'))}" styleClass="ribbon-button ribbon-button-small"
                                   ajax="true" partialSubmit="true" process="@this" includeViewParams="true" >
                        <span class="button-title">#{messages['general.button.Bookmark']}</span> 
                        <h:graphicImage url="/img/ribbon/small/bookmark.png" styleClass="ribbon-icon ribbon-normal"/>
                    </p:commandLink>





                </div>

            </h:form>



            <ui:remove>
                <div class="ribbon-section right">
                    <h:form id="quickLauncher">
                        <div class="ribbon-button-small">
                            <p:outputLabel value="#{messages['general.label.QuickSearch']}" styleClass="name" style="font-size: 8pt; font-weight: normal;"/>
                            <p:inputText id="launcherkey" value="#{quickLauncher.key}" onkeypress="if (event.keyCode == 13) {
                                        jQuery('#quickLauncher\\:launcherbtn').click();
                                        return false;

                                    }" style="width: 120px !important; font-size: 8pt;" styleClass="value button-title"/>
                            <p:commandButton id="launcherbtn" action="#{quickLauncher.redirect()}" style="display: none;"/>
                        </div>
                    </h:form>
                </div>
            </ui:remove>

            <ui:insert name="ribbon-actions"/>

            <c:forEach id="secrepeater" items="#{ribbonContextController.getContextSections()}" var="section" varStatus="rowCounter1">


                <ui:insert name="ribbon-section-before" />

                <div class="ribbon-section #{section.alignment}">

                    <span class="section-title">#{messages[section.label]}</span>

                    <ui:insert name="ribbon-section-action-before" />


                    <c:forEach id="actrepeater" items="#{section.actions}" var="action" varStatus="rowCounter2">
                        <t:ribbonAction actionItem="#{action.action}" buttonType="#{action.type}" counter="#{rowCounter2}" classifier="#{action.classifier}" params="#{action.params}"/>
                    </c:forEach>


                    <ui:insert name="ribbon-section-action-after" />

                </div>

                <ui:insert name="ribbon-section-after" />
            </c:forEach>

            <ui:insert name="ribbon-actions-after"/>

        </div>

        <ui:remove>
        <!-- FIXME: #15465 p:cache key="ribbon" region="ribbon-#{identity.account.id}"  -->
            </ui:remove>

            <c:forEach id="tabrepeater" items="#{ribbonController.getTabs()}"
                       var="tab" varStatus="tabCounter">

                <div class="ribbon-tab #{tab.id eq 'workspace' ? 'color-orange' : '' }" id="#{tab.id}">
                    <span class="ribbon-title">#{messages[tab.label]}</span>
                    <c:forEach id="secrepeater" items="#{tab.sections}"
                               var="section" varStatus="rowCounter1">
                        <div class="ribbon-section">
                            <span class="section-title">#{messages[section.label]}</span>


                            <c:forEach id="actrepeater" items="#{section.actions}"
                                       var="action" varStatus="rowCounter2">

                                <t:ribbonAction actionItem="#{action.action}" classifier="#{classifier}" buttonType="#{action.type}" counter="#{rowCounter2}" params="#{action.params}"/>

                            </c:forEach>

                        </div>
                    </c:forEach>
                </div>
            </c:forEach>
            <ui:remove>
        <!-- /p:cache -->
</ui:remove>

    </div>
</ui:composition>